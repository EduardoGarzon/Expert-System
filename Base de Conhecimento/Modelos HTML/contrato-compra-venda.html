<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Contrato</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: 'Times New Roman', Arial, sans-serif;
            font-size: 16px;
        }

        main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            padding: 20px;
        }

        #buttons {
            padding: 2rem;
        }

        #exportPDF,
        #exportDocx {
            padding: 0.5rem;
            font-weight: bold;
            font-family: monospace, sans-serif, Arial, Helvetica;
            cursor: pointer;
        }

        #contrato {
            margin-top: 1rem;
            width: 210mm;
            min-height: 297mm;
            background-color: white;
            padding: 2.55cm;
            box-shadow: 0 0 10px rgba(0, 0, 0);
            border: 1px solid #ddd;
            text-align: justify;
        }

        h1 {
            text-align: center;
            font-size: 18px;
            margin-bottom: 2rem;
        }

        h2 {
            text-align: left;
            margin-bottom: 0.5rem;
            margin-top: 2rem;
        }

        p,
        ul {
            margin-bottom: 1rem;
        }

        ul {
            margin-left: 1rem;
        }

        li {
            padding: 0.5rem;
        }

        #grifar {
            background-color: yellow;
        }
    </style>
</head>

<body>
    <main>
        <section id="buttons">
            <button id="exportPDF">Exportar para PDF</button>
            <button id="exportDocx">Exportar para DOCX</button>
        </section>

        <section id="contrato">
            <h1>CONTRATO DE COMPRA E VENDA</h1>

            <p><strong>Pelo presente instrumento particular, de um lado:</strong></p>

            <p>
                <strong>VENDEDOR:</strong> 
                <span id="grifar">
                    <strong>
                        [Nome completo ou razão social], [Nacionalidade], [Estado civil], [Profissão], 
                        portador(a) do CPF/CNPJ nº [__________], residente e domiciliado(a) na [endereço completo].
                    </strong>
                </span>
            </p>

            <p>
                <strong>COMPRADOR:</strong> 
                <span id="grifar">
                    <strong>
                        [Nome completo ou razão social], [Nacionalidade], [Estado civil], [Profissão], 
                        portador(a) do CPF/CNPJ nº [__________], residente e domiciliado(a) na [endereço completo].
                    </strong>
                </span>
            </p>

            <p>
                <strong>
                    Têm entre si, de maneira justa e contratada, o presente contrato de compra e venda, 
                    que se regerá pelas cláusulas seguintes:
                </strong>
            </p>

            <h2>CLÁUSULA 1 – OBJETO DO CONTRATO</h2>
            <p>
                O presente contrato tem como objeto a compra e venda do bem 
                <span id="grifar"><strong>[descrever o bem: imóvel.]</strong></span>, 
                de propriedade do VENDEDOR, que o vende ao COMPRADOR, nas condições estipuladas neste contrato.
            </p>

            <h2>CLÁUSULA 2 – PREÇO E FORMA DE PAGAMENTO</h2>
            <p>
                O preço total do bem é de <span id="grifar"><strong>R$ [valor]</strong></span>, 
                a ser pago pelo COMPRADOR ao VENDEDOR da seguinte forma: 
                <span id="grifar"><strong>[detalhar a forma de pagamento - à vista, parcelado, transferência bancária, etc.]</strong></span>, 
                conforme acordado entre as partes.
            </p>

            <h2>CLÁUSULA 3 – ENTREGA DO BEM</h2>
            <p>
                O VENDEDOR se compromete a entregar o bem objeto deste contrato no prazo de 
                <span id="grifar"><strong>[X] dias</strong></span> após a assinatura do presente contrato, 
                no endereço <span id="grifar"><strong>[detalhar o local de entrega, se necessário].</strong></span>
            </p>

            <h2>CLÁUSULA 4 – TRANSFERÊNCIA DE PROPRIEDADE</h2>
            <p>
                A transferência da propriedade do bem ocorrerá após o pagamento integral 
                do valor acordado e a formalização da entrega do bem. 
                O VENDEDOR se compromete a fornecer todos os documentos necessários 
                para a transferência de titularidade do bem ao COMPRADOR.
            </p>

            <h2>CLÁUSULA 5 – RESPONSABILIDADE PELOS DÉBITOS</h2>
            <p>
                O VENDEDOR declara que o bem encontra-se livre de qualquer ônus, gravame ou dívida, 
                respondendo integralmente pela quitação de débitos anteriores à data de entrega, caso existam.
            </p>
            
            <h2>CLÁUSULA 6 - DAS DESPESAS</h2>
            <p>
                Todas as despesas de registro do presente contrato e da futura escritura com todas as taxas e impostos devidos, 
                correrão por conta exclusiva do COMPRADOR em especial, se for o caso, as abaixo relacionadas:
            </p>
            <ul> 
                <li>Imposto de transmissão (ITBI);</li>
                <li>Emolumentos e custos de Registros de imóveis;</li>
                <li>Custos e emolumentos do Cartório de Notas;</li>
                <li>
                    Despesas indispensáveis à instalação, 
                    funcionamento regulamentação do condomínio na proporção das respectivas frações ideais do terreno.
                </li>
            </ul>

            <h2>CLÁUSULA 7 – GARANTIA DO BEM</h2>
            <p>
                O VENDEDOR garante que o bem objeto deste contrato está em perfeito estado de conservação e funcionamento, 
                e que não existem vícios ou defeitos ocultos que possam prejudicar o uso do bem para a finalidade a que se destina. 
                O COMPRADOR tem o prazo de <span id="grifar"><strong>[X] dias</strong></span> 
                para comunicar ao VENDEDOR qualquer defeito ou não conformidade.
            </p>
            
            <h2>CLÁUSULA 8 – RISCO E RESPONSABILIDADE</h2>
            <p>
                A partir da entrega do bem, o risco sobre o bem será transferido para o COMPRADOR, 
                o qual assume a responsabilidade por quaisquer danos ou perdas que possam ocorrer após essa entrega.
            </p>

            <h2>CLÁUSULA 9 – CONDIÇÕES DE PAGAMENTO E MULTA POR INADIMPLEMENTO</h2>
            <p>
                Em caso de inadimplemento das parcelas acordadas, o COMPRADOR estará sujeito ao pagamento de multa de 
                <span id="grifar"><strong>[X]%</strong></span> sobre o valor da parcela em atraso, 
                acrescido de juros de <span id="grifar"><strong>[X]% ao mês</strong></span>, 
                sem prejuízo das demais penalidades previstas neste contrato.   
            </p>
            <p>
                <span id="grifar"><strong>(essa multa tem que abrir a opção de a pessoa decidir)</strong></span>
            </p>
            
            <h2>CLÁUSULA 10 – RESCISÃO CONTRATUAL</h2>
            <p>
                O contrato poderá ser rescindido em caso de descumprimento das obrigações assumidas por qualquer das partes. 
                Em caso de rescisão por culpa do COMPRADOR, este deverá restituir o bem ao VENDEDOR, e, 
                caso o VENDEDOR seja o responsável pela rescisão, 
                deverá devolver ao COMPRADOR os valores pagos, 
                descontadas as despesas eventuais.
            </p>

            <h2>CLÁUSULA 11 – FORO</h2>
            <p>
                Fica eleito o foro da comarca de <span id="grifar"><strong>[cidade e estado]</strong></span> 
                para dirimir quaisquer dúvidas ou litígios oriundos deste contrato,
                renunciando as partes a qualquer outro, por mais privilegiado que seja.
            </p>   

            <p style="margin-top: 10rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Local e Data</strong></p>
            <p style="margin-top: 5rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Assinatura do Vendedor</strong></p>
            <p style="margin-top: 5rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Assinatura do Comprador</strong></p>
            <p style="margin-top: 5rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Assinatura da Testemunha 1</strong></p>
            <p style="margin-top: 5rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Assinatura da Testemunha 2</strong></p>
        </section>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById('exportPDF').addEventListener("click", () => {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF("p", "mm", "a4");

                const margin = 25.5; 
                let y = margin;      

                const contrato = document.getElementById("contrato");
                const pageWidth = pdf.internal.pageSize.getWidth() - 2 * margin;

                pdf.setFont("times", "normal");

                function processElement(element) {
                    if (element.tagName === "H1") {
                        pdf.setFontSize(14);
                        pdf.setFont("times", "bold");

                        let title = element.innerText;
                        let splitTitle = pdf.splitTextToSize(title, pageWidth);
                        let titleHeight = splitTitle.length * 6;

                        if (y + titleHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            y = margin;
                        }

                        let titleWidth = pdf.getTextWidth(title);
                        pdf.text(title, (pageWidth - titleWidth) / 2 + margin, y);
                        y += titleHeight + 5;
                    } else if (element.tagName === "H2") {
                        pdf.setFontSize(12);
                        pdf.setFont("times", "bold");

                        let title = element.innerText;
                        let splitTitle = pdf.splitTextToSize(title, pageWidth);
                        let titleHeight = splitTitle.length * 6;

                        if (y + titleHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            y = margin;
                        }

                        pdf.text(splitTitle, margin, y); 
                        y += titleHeight + 5;
                    } else if (element.tagName === "P" || element.tagName === "LI") {
                        pdf.setFontSize(12);
                        pdf.setFont("times", "normal");

                        let text = element.innerText;
                        let splitText = pdf.splitTextToSize(text, pageWidth);
                        let textHeight = splitText.length * 6;

                        if (y + textHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            y = margin;
                        }

                        pdf.text(splitText, margin, y); 
                        y += textHeight + 5;
                    } else if (element.tagName === "UL") {
                        pdf.setFontSize(12);
                        pdf.setFont("times", "normal");
                        
                        for (let li of element.children) {
                            let bulletText = `• ${li.innerText}`;
                            let splitBullet = pdf.splitTextToSize(bulletText, pageWidth);
                            let textHeight = splitBullet.length * 6;

                            if (y + textHeight > pdf.internal.pageSize.getHeight() - margin) {
                                pdf.addPage();
                                y = margin;
                            }

                            pdf.text(splitBullet, margin, y);
                            y += textHeight + 2;
                        }
                        return;
                    }
                }

                for (let el of contrato.children) {
                    processElement(el);
                }

                pdf.save("contrato.pdf");
            });
        });

        document.getElementById("exportDocx").addEventListener("click", () => {
            if (!window.docx) {
                alert("A biblioteca docx ainda não carregou. Tente novamente.");
                return;
            }

            const { Document, Packer, Paragraph, TextRun, AlignmentType, Numbering, LevelFormat } = window.docx;
            const contrato = document.getElementById("contrato");

            let children = [];
            let listCounter = 1; 

            contrato.childNodes.forEach(node => {
                if (node.nodeType === Node.ELEMENT_NODE) {
                    let textRuns = [new TextRun({ text: node.innerText })];
                    let paragraphProps = { spacing: { after: 200 } };

                    if (node.tagName === "H1") {
                        textRuns = [new TextRun({ text: node.innerText, bold: true, size: 28 })];
                        paragraphProps.alignment = AlignmentType.CENTER;
                    } else if (node.tagName === "H2") {
                        textRuns = [new TextRun({ text: node.innerText, bold: true, size: 24 })];
                        paragraphProps.alignment = AlignmentType.LEFT;
                    } else if (node.tagName === "P") {
                        textRuns = [new TextRun({ text: node.innerText, size: 24 })];
                        paragraphProps.alignment = AlignmentType.JUSTIFIED;
                    } else if (node.tagName === "UL") {
                        Array.from(node.children).forEach((li) => {
                            let listItemText = li.innerText;

                            children.push(new Paragraph({
                                children: [new TextRun({ text: listItemText, size: 24 })],
                                bullet: { level: 0 }                            
                            }));
                        });

                        return; 
                    }
                    children.push(new Paragraph({ children: textRuns, ...paragraphProps }));
                }
            });

            const doc = new Document({
                numbering: {
                    config: [{
                        reference: "numbered-list",
                        levels: [{
                            level: 0,
                            format: LevelFormat.DECIMAL,
                            text: "%1.",
                            alignment: AlignmentType.LEFT,
                        }]
                    }]
                },
                sections: [{
                    properties: {},
                    children
                }]
            });

            Packer.toBlob(doc).then(blob => {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "contrato.docx";
                link.click();
            });
        });
    </script>
</body>

</html>