<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Contrato</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: 'Times New Roman', Arial, sans-serif;
            font-size: 16px;
        }

        main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            padding: 20px;
        }

        #buttons {
            padding: 2rem;
        }

        #exportPDF,
        #exportDocx {
            padding: 0.5rem;
            font-weight: bold;
            font-family: monospace, sans-serif, Arial, Helvetica;
            cursor: pointer;
        }

        #contrato {
            margin-top: 1rem;
            width: 210mm;
            min-height: 297mm;
            background-color: white;
            padding: 2.55cm;
            box-shadow: 0 0 10px rgba(0, 0, 0);
            border: 1px solid #ddd;
            text-align: justify;
        }

        h1 {
            text-align: center;
            font-size: 18px;
            margin-bottom: 2rem;
        }

        h2 {
            text-align: left;
            margin-bottom: 0.5rem;
            margin-top: 2rem;
        }

        p,
        ul {
            margin-bottom: 1rem;
        }

        ul {
            margin-left: 1rem;
        }

        li {
            padding: 0.5rem;
        }

        #grifar {
            background-color: yellow;
        }
    </style>
</head>

<body>
    <main>
        <section id="buttons">
            <button id="exportPDF">Exportar para PDF</button>
            <button id="exportDocx">Exportar para DOCX</button>
        </section>

        <section id="contrato">
            <h1>CONTRATO DE COMODATO DE IMÓVEL</h1>

            <p><strong>Pelo presente instrumento particular de contrato de comodato, as partes abaixo identificadas:</strong></p>

            <p>
                <strong>COMODANTE:</strong>
                <span id="grifar">
                    <strong>
                        [Nome completo], [qualificação completa], residente e domiciliado à [endereço completo].
                    </strong>
                </span>
            </p>

            <p>
                <strong>COMODATÁRIO:</strong>
                <span id="grifar">
                    <strong>
                        [Nome completo], [qualificação completa], residente e domiciliado à [endereço completo].
                    </strong>
                </span>
            </p>

            <p><strong>Têm entre si, justas e contratadas, as seguintes cláusulas e condições:</strong></p>

            <h2>CLÁUSULA 1 - OBJETO DO CONTRATO</h2>
            <p>
                O COMODANTE cede ao COMODATÁRIO, a título gratuito, o imóvel localizado à 
                <span id="grifar"><strong>[endereço completo do imóvel]</strong></span>, 
                com as seguintes características: 
                <span id="grifar"><strong>[descrição detalhada do imóvel, incluindo número de matrícula, área etc.]</strong></span>.
            </p>
            <p>
                O imóvel é cedido para fins de strong<span id="grifar"><strong>[especificar a finalidade, por exemplo, residência, comércio etc.]</strong></span>, 
                não podendo ser utilizado para outros fins sem a prévia autorização do COMODANTE.
            </p>

            <h2>CLÁUSULA 2 - PRAZO DE COMODATO</h2>
            <p>
                O prazo de duração do comodato será de <span id="grifar"><strong>[prazo em meses ou anos]</strong></span>, 
                iniciando-se em <span id="grifar"><strong>[data de início]</strong></span> 
                e terminando em <span id="grifar"><strong>[data de término]</strong></span>, 
                salvo se prorrogado por ambas as partes por escrito.
            </p>

            <h2>CLÁUSULA 3 - OBRIGAÇÕES DO COMODATÁRIO</h2>
            <p>O COMODATÁRIO se compromete a:</p>
            <ul>
                <li>Utilizar o imóvel exclusivamente para a finalidade estabelecida neste contrato;</li>
                <li>Conservar o imóvel, mantendo-o em bom estado de uso e habitabilidade;</li>
                <li>Realizar reparos necessários ao imóvel, caso seja responsável por danos causados por seu uso;</li>
                <li>Devolver o imóvel ao COMODANTE no prazo acordado, em perfeitas condições de uso, salvo desgastes naturais do tempo.</li>
            </ul>

            <h2>CLÁUSULA 4 - OBRIGAÇÕES DO COMODANTE</h2>
            <p>O COMODANTE se compromete a:</p>
            <ul>
                <li>Entregar o imóvel ao COMODATÁRIO em boas condições de uso e habitabilidade;</li>
                <li>Garantir o uso pacífico do imóvel durante o prazo do contrato, não permitindo que terceiros impeçam o uso regular do imóvel.</li>
            </ul>
            
            <h2>CLÁUSULA 5 - MANUTENÇÃO E REPAROS</h2>
            <p>
                O COMODATÁRIO será responsável pelos reparos decorrentes de seu uso e pela manutenção do imóvel, 
                exceto nos casos de deterioração natural do imóvel.
            </p>
            <p>O COMODANTE poderá, a qualquer momento, solicitar vistorias no imóvel para verificar suas condições.</p>

            <h2>CLÁUSULA 6 - CESSÃO E SUBLOCAÇÃO</h2>
            <p>
                O COMODATÁRIO não poderá ceder, sublocar ou transferir os direitos do presente contrato a terceiros, 
                total ou parcialmente, sem o consentimento prévio e por escrito do COMODANTE.
            </p>

            <h2>CLÁUSULA 7 - RESCISÃO ANTECIPADA</h2>
            <p>
                Este contrato poderá ser rescindido por qualquer das partes, a qualquer tempo, mediante notificação por escrito, 
                com antecedência mínima de <span id="grifar"><strong>[número de dias] dias</strong></span>.
            </p>
            <p>
                Caso o COMODATÁRIO deixe de cumprir com qualquer das obrigações aqui estabelecidas, 
                o COMODANTE poderá rescindir o contrato imediatamente, sem prejuízo de exigir a devolução do imóvel.
            </p>

            <h2>CLÁUSULA 8 - MULTA POR DESCUMPRIMENTO</h2>
            <p>
                O não cumprimento de qualquer cláusula do presente contrato 
                implicará no pagamento de uma multa no valor de <span id="grifar"><strong>[valor da multa]</strong></span>, 
                a ser paga pela parte inadimplente à parte prejudicada.
            </p>

            <h2>CLÁUSULA 09 – FORO</h2>
            <p>
                Fica eleito o foro da comarca de <span id="grifar"><strong>[cidade e estado]</strong></span> 
                para dirimir quaisquer dúvidas ou litígios oriundos deste contrato,
                renunciando as partes a qualquer outro, por mais privilegiado que seja.
            </p>

            <h2>CLÁUSULA 10 - DISPOSIÇÕES GERAIS</h2>
            <p>Este contrato não estabelece vínculo empregatício, societário ou de qualquer outra natureza entre as partes.</p>
            <p>Qualquer alteração neste contrato deverá ser feita por escrito, com a concordância de ambas as partes.</p>
            <p>
                As partes declaram que leram e entenderam todas as cláusulas deste contrato, 
                estando de pleno acordo com seus termos, 
                e que assinam em dois exemplares de igual teor e forma, sendo um para cada parte.
            </p>

            <p style="margin-top: 10rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Local e Data</strong></p>
            <p style="margin-top: 5rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Assinatura do Comodante</strong></p>
            <p style="margin-top: 5rem; text-align: center;">__________________________________</p>
            <p style="text-align: center;"><strong>Assinatura do Comodatário</strong></p>
        </section>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById('exportPDF').addEventListener("click", () => {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF("p", "mm", "a4");

                const margin = 25.5; 
                let y = margin;      

                const contrato = document.getElementById("contrato");
                const pageWidth = pdf.internal.pageSize.getWidth() - 2 * margin;

                pdf.setFont("times", "normal");

                function processElement(element) {
                    if (element.tagName === "H1") {
                        pdf.setFontSize(14);
                        pdf.setFont("times", "bold");

                        let title = element.innerText;
                        let splitTitle = pdf.splitTextToSize(title, pageWidth);
                        let titleHeight = splitTitle.length * 6;

                        if (y + titleHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            y = margin;
                        }

                        let titleWidth = pdf.getTextWidth(title);
                        pdf.text(title, (pageWidth - titleWidth) / 2 + margin, y);
                        y += titleHeight + 5;
                    } else if (element.tagName === "H2") {
                        pdf.setFontSize(12);
                        pdf.setFont("times", "bold");

                        let title = element.innerText;
                        let splitTitle = pdf.splitTextToSize(title, pageWidth);
                        let titleHeight = splitTitle.length * 6;

                        if (y + titleHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            y = margin;
                        }

                        pdf.text(splitTitle, margin, y); 
                        y += titleHeight + 5;
                    } else if (element.tagName === "P" || element.tagName === "LI") {
                        pdf.setFontSize(12);
                        pdf.setFont("times", "normal");

                        let text = element.innerText;
                        let splitText = pdf.splitTextToSize(text, pageWidth);
                        let textHeight = splitText.length * 6;

                        if (y + textHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            y = margin;
                        }

                        pdf.text(splitText, margin, y); 
                        y += textHeight + 5;
                    } else if (element.tagName === "UL") {
                        pdf.setFontSize(12);
                        pdf.setFont("times", "normal");
                        
                        for (let li of element.children) {
                            let bulletText = `• ${li.innerText}`;
                            let splitBullet = pdf.splitTextToSize(bulletText, pageWidth);
                            let textHeight = splitBullet.length * 6;

                            if (y + textHeight > pdf.internal.pageSize.getHeight() - margin) {
                                pdf.addPage();
                                y = margin;
                            }

                            pdf.text(splitBullet, margin, y);
                            y += textHeight + 2;
                        }
                        return;
                    }
                }

                for (let el of contrato.children) {
                    processElement(el);
                }

                pdf.save("contrato.pdf");
            });
        });

        document.getElementById("exportDocx").addEventListener("click", () => {
            if (!window.docx) {
                alert("A biblioteca docx ainda não carregou. Tente novamente.");
                return;
            }

            const { Document, Packer, Paragraph, TextRun, AlignmentType, Numbering, LevelFormat } = window.docx;
            const contrato = document.getElementById("contrato");

            let children = [];
            let listCounter = 1; 

            contrato.childNodes.forEach(node => {
                if (node.nodeType === Node.ELEMENT_NODE) {
                    let textRuns = [new TextRun({ text: node.innerText })];
                    let paragraphProps = { spacing: { after: 200 } };

                    if (node.tagName === "H1") {
                        textRuns = [new TextRun({ text: node.innerText, bold: true, size: 28 })];
                        paragraphProps.alignment = AlignmentType.CENTER;
                    } else if (node.tagName === "H2") {
                        textRuns = [new TextRun({ text: node.innerText, bold: true, size: 24 })];
                        paragraphProps.alignment = AlignmentType.LEFT;
                    } else if (node.tagName === "P") {
                        textRuns = [new TextRun({ text: node.innerText, size: 24 })];
                        paragraphProps.alignment = AlignmentType.JUSTIFIED;
                    } else if (node.tagName === "UL") {
                        Array.from(node.children).forEach((li) => {
                            let listItemText = li.innerText;

                            children.push(new Paragraph({
                                children: [new TextRun({ text: listItemText, size: 24 })],
                                bullet: { level: 0 }                            
                            }));
                        });

                        return; 
                    }
                    children.push(new Paragraph({ children: textRuns, ...paragraphProps }));
                }
            });

            const doc = new Document({
                numbering: {
                    config: [{
                        reference: "numbered-list",
                        levels: [{
                            level: 0,
                            format: LevelFormat.DECIMAL,
                            text: "%1.",
                            alignment: AlignmentType.LEFT,
                        }]
                    }]
                },
                sections: [{
                    properties: {},
                    children
                }]
            });

            Packer.toBlob(doc).then(blob => {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "contrato.docx";
                link.click();
            });
        });
    </script>
</body>

</html>